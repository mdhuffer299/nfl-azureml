/* 
	Author:			Michael Huffer
	Description:	DML for play_by_play table used for Azure ML play type classification model training and testing.
					This table contains play-by-play data for the 2009-2017 NFL seasons.  The data attributes leveraged in the model are filtered out when pulled into Azure ML.
					This script is part of a collection of SQL, R, Azure ML, and Power BI artifacts that have been prepared for a SQL Saturday presentation.
*/

USE [NFL]
GO

IF OBJECT_ID('dbo.play_by_play', 'U') IS NOT NULL
TRUNCATE TABLE dbo.play_by_play;
GO

INSERT INTO [dbo].[play_by_play]
(
	[GAME_DATE]
	,[GAME_ID]
	,[PLAY_ID]
	,[DRIVE]
	,[QTR]
	,[DOWN]
	,[GAME_TIME]
	,[TIME_UNDER]
	,[TIME_SECS]
	,[PLAY_TIME_DIFF]
	,[SIDE_OF_FIELD]
	,[YARD_LINE]
	,[YARD_LINE_100]
	,[YARDS_TO_GO]
	,[YARDS_NET]
	,[GOAL_TO_GO]
	,[FIRST_DOWN]
	,[POS_TEAM]
	,[DEF_TEAM]
	,[PLAY_ATTEMPTED]
	,[YARDS_GAINED]
	,[SP]
	,[TOUCHDOWN]
	,[EX_POINT_RESULT]
	,[TWO_POINT_CONVERSION]
	,[DEF_TWO_POINT]
	,[SAFETY]
	,[ONSIDE_KICK]
	,[PUNT_RESULT]
	,[PLAY_TYPE]
	,[PASSER]
	,[PASSER_ID]
	,[PASS_ATTEMPT]
	,[PASS_OUTCOME]
	,[PASS_LENGTH]
	,[AIR_YARDS]
	,[YARDS_AFTER_CATCH]
	,[QB_HIT]
	,[PASS_LOCATION]
	,[INTERCEPTION_THROWN]
	,[INTERCEPTOR]
	,[RUSHER]
	,[RUSHER_ID]
	,[RUSH_ATTEMPT]
	,[RUN_LOCATION]
	,[RUN_GAP]
	,[RECEIVER]
	,[RECEIVER_ID]
	,[RECEPTION]
	,[RETURN_RESULT]
	,[RETURNER]
	,[BLOCKING_PLAYER]
	,[TACKLER_1]
	,[TACKLER_2]
	,[FIELD_GOAL_RESULT]
	,[FIELD_GOAL_DISTANCE]
	,[FUMBLE]
	,[REC_FUMB_TEAM]
	,[REC_FUMB_PLAYER]
	,[SACK]
	,[CHALLENGE_REPLAY]
	,[CHALLENGE_REPLAY_RESULT]
	,[ACCEPTED_PENALTY]
	,[PENALIZED_TEAM]
	,[PENALIZED_PLAYER]
	,[PENALTY_YARDS]
	,[POS_TEAM_SCORE]
	,[DEF_TEAM_SCORE]
	,[SCORE_DIFF]
	,[ABS_SCORE_DIFF]
	,[HOME_TEAM]
	,[AWAY_TEAM]
	,[TIMEOUT_INDICATOR]
	,[TIMEOUT_TEAM]
	,[POSTEAM_TIMEOUTS_PRE]
	,[HOME_TIMEOUTS_REMAINING_PRE]
	,[AWAY_TIMEOUTS_REMAINING_PRE]
	,[HOME_TIMEOUTS_REMAINING_POST]
	,[AWAY_TIMEOUTS_REMAINING_POST]
	,[SEASON]
	,[INSERT_DATE]
)
SELECT 
	TRY_CAST([GAME_DATE] AS DATE) AS [GAME_DATE]
	,TRY_CAST(REPLACE([GAME_ID], 'NA', '0') AS INT) AS [GAME_ID]
	,TRY_CAST(REPLACE([PLAY_ID], 'NA', '0') AS INT) AS [PLAY_ID]
	,TRY_CAST(REPLACE([DRIVE], 'NA', '0') AS INT) AS [DRIVE]
	,TRY_CAST(REPLACE([QTR], 'NA', '0') AS INT) AS [QTR]
	,TRY_CAST(REPLACE([DOWN], 'NA', '0') AS INT) AS [DOWN]
	,[GAME_TIME]
	,TRY_CAST(REPLACE([TIME_UNDER], 'NA', '0') AS INT) AS [TIME_UNDER]
	,TRY_CAST(REPLACE([TIME_SECS], 'NA', '0') AS INT) AS [TIME_SECS]
	,TRY_CAST(REPLACE([PLAY_TIME_DIFF], 'NA', '0') AS INT) AS [PLAY_TIME_DIFF]
	,[SIDE_OF_FIELD]
	,TRY_CAST(REPLACE([YARD_LINE], 'NA', '0') AS INT) AS [YARD_LINE]
	,TRY_CAST(REPLACE([YARD_LINE_100], 'NA', '0') AS INT) AS [YARD_LINE_100]
	,TRY_CAST(REPLACE([YARDS_TO_GO], 'NA', '0') AS INT) AS [YARDS_TO_GO]
	,TRY_CAST(REPLACE([YARDS_NET], 'NA', '0') AS INT) AS [YARDS_NET]
	,TRY_CAST(REPLACE([GOAL_TO_GO], 'NA', '0') AS INT) AS [GOAL_TO_GO]
	,TRY_CAST(REPLACE([FIRST_DOWN], 'NA', '0') AS BIT) AS [FIRST_DOWN]
	,[POS_TEAM]
	,[DEF_TEAM]
	,TRY_CAST(REPLACE([PLAY_ATTEMPTED], 'NA', '0') AS INT) AS [PLAY_ATTEMPTED]
	,TRY_CAST(REPLACE([YARDS_GAINED], 'NA', '0') AS INT) AS [YARDS_GAINED]
	,TRY_CAST(REPLACE([SP], 'NA', '0') AS BIT) AS [SP]
	,TRY_CAST(REPLACE([TOUCHDOWN], 'NA', '0') AS BIT) AS [TOUCHDOWN]
	,[EX_POINT_RESULT]
	,[TWO_POINT_CONVERSION]
	,[DEF_TWO_POINT]
	,TRY_CAST(REPLACE([SAFETY], 'NA', '0') AS BIT) AS [SAFETY]
	,TRY_CAST(REPLACE([ONSIDE_KICK], 'NA', '0') AS BIT) AS [ONSIDE_KICK]
	,[PUNT_RESULT]
	,[PLAY_TYPE]
	,[PASSER]
	,[PASSER_ID]
	,TRY_CAST(REPLACE([PASS_ATTEMPT], 'NA', '0') AS BIT) AS [PASS_ATTEMPT]
	,[PASS_OUTCOME]
	,[PASS_LENGTH]
	,TRY_CAST(REPLACE([AIR_YARDS], 'NA', '0') AS INT) AS [AIR_YARDS]
	,TRY_CAST(REPLACE([YARDS_AFTER_CATCH], 'NA', '0') AS INT) AS [YARDS_AFTER_CATCH]
	,TRY_CAST(REPLACE([QB_HIT], 'NA', '0') AS BIT) AS [QB_HIT]
	,[PASS_LOCATION]
	,TRY_CAST(REPLACE([INTERCEPTION_THROWN], 'NA', '0') AS BIT) AS [INTERCEPTION_THROWN]
	,[INTERCEPTOR]
	,[RUSHER]
	,[RUSHER_ID]
	,TRY_CAST(REPLACE([RUSH_ATTEMPT], 'NA', '0') AS BIT) AS [RUSH_ATTEMPT]
	,[RUN_LOCATION]
	,[RUN_GAP]
	,[RECEIVER]
	,[RECEIVER_ID]
	,TRY_CAST(REPLACE([RECEPTION], 'NA', '0') AS BIT) AS [RECEPTION]
	,[RETURN_RESULT]
	,[RETURNER]
	,[BLOCKING_PLAYER]
	,[TACKLER_1]
	,[TACKLER_2]
	,[FIELD_GOAL_RESULT]
	,TRY_CAST(REPLACE([FIELD_GOAL_DISTANCE],'NA', '0') AS INT) AS [FIELD_GOAL_DISTANCE]
	,TRY_CAST(REPLACE([FUMBLE],'NA','0') AS BIT) AS [FUMBLE]
	,[REC_FUMB_TEAM]
	,[REC_FUMB_PLAYER]
	,TRY_CAST(REPLACE([SACK],'NA','0') AS BIT) AS [SACK]
	,TRY_CAST(REPLACE([CHALLENGE_REPLAY], 'NA', '0') AS BIT) AS [CHALLENGE_REPLAY]
	,[CHALLENGE_REPLAY_RESULT]
	,TRY_CAST(REPLACE([ACCEPTED_PENALTY], 'NA', '0') AS BIT) AS [ACCEPTED_PENALTY]
	,[PENALIZED_TEAM]
	,[PENALIZED_PLAYER]
	,TRY_CAST(REPLACE([PENALTY_YARDS], 'NA', '0') AS INT) AS [PENALTY_YARDS]
	,TRY_CAST(REPLACE([POS_TEAM_SCORE], 'NA', '0') AS INT) AS [POS_TEAM_SCORE]
	,TRY_CAST(REPLACE([DEF_TEAM_SCORE], 'NA', '0') AS INT) AS [DEF_TEAM_SCORE]
	,TRY_CAST(REPLACE([SCORE_DIFF], 'NA', '0') AS INT) AS [SCORE_DIFF]
	,TRY_CAST(REPLACE([ABS_SCORE_DIFF], 'NA', '0') AS INT) AS [ABS_SCORE_DIFF]
	,[HOME_TEAM]
	,[AWAY_TEAM]
	,TRY_CAST(REPLACE([TIMEOUT_INDICATOR], 'NA', '0') AS BIT) AS [TIMEOUT_INDICATOR]
	,[TIMEOUT_TEAM]
	,TRY_CAST(REPLACE([POSTEAM_TIMEOUTS_PRE], 'NA', '0') AS INT) AS [POSTEAM_TIMEOUTS_PRE]
	,TRY_CAST(REPLACE([HOME_TIMEOUTS_REMAINING_PRE], 'NA', '0') AS INT) AS [HOME_TIMEOUTS_REMAINING_PRE]
	,TRY_CAST(REPLACE([AWAY_TIMEOUTS_REMAINING_PRE], 'NA', '0') AS INT) AS [AWAY_TIMEOUTS_REMAINING_PRE]
	,TRY_CAST(REPLACE([HOME_TIMEOUTS_REMAINING_POST], 'NA', '0') AS INT) AS [HOME_TIMEOUTS_REMAINING_POST]
	,TRY_CAST(REPLACE([AWAY_TIMEOUTS_REMAINING_POST], 'NA', '0') AS INT) AS [AWAY_TIMEOUTS_REMAINING_POST]
	,[SEASON]
	,GETDATE() AS INSERT_DATE
  FROM [dbo].[play_by_play_stg]
  WHERE [SEASON] <> 2017
GO